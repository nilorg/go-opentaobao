package opentaobao

import (
	"fmt"
	"log"
	"testing"
	"time"
)

func init() {
	AppKey = ""
	AppSecret = ""
	Router = "http://gw.api.taobao.com/router/rest"
	GetCache = func(cacheKey string) []byte {
		log.Printf("GetCache key:%s\n", cacheKey)
		//return nil
		return []byte(`{"tbk_item_get_response":{"request_id":"111111111","results":{"n_tbk_item":[{"item_url":"http://item.taobao.com/item.htm?id=538630988422","nick":"团团圆圆0112","num_iid":538630988422,"pict_url":"https://img.alicdn.com/tfscom/i3/2423654159/TB2siwaXezz11Bjy1XdXXbfqVXa_!!2423654159.jpg","provcity":"河北 廊坊","reserve_price":"38.00","seller_id":2423654159,"small_images":{"string":["https://img.alicdn.com/tfscom/i2/2423654159/TB21TEXXeYC11Bjy1zkXXaZdXXa_!!2423654159.jpg","https://img.alicdn.com/tfscom/i2/2423654159/TB2RpwaXbbC11BjSszbXXXRbpXa_!!2423654159.jpg","https://img.alicdn.com/tfscom/i3/2423654159/TB2Q97aXmPA11Bjy0FaXXbucXXa_!!2423654159.jpg","https://img.alicdn.com/tfscom/i1/2423654159/TB2pzccXk6z11Bjy0FoXXbvkpXa_!!2423654159.jpg"]},"title":"中老年女装弹力高腰中年人直筒加肥加大码妈妈裤女牛仔裤休闲长裤","user_type":0,"volume":1022,"zk_final_price":"38.00"},{"item_url":"http://item.taobao.com/item.htm?id=574577726888","nick":"下一秒钟爱情","num_iid":574577726888,"pict_url":"https://img.alicdn.com/tfscom/i3/893191533/TB2NjlXHHuWBuNjSszgXXb8jVXa_!!893191533.jpg","provcity":"广东 广州","reserve_price":"109.00","seller_id":893191533,"small_images":{"string":["https://img.alicdn.com/tfscom/i2/893191533/TB2RHGuHNWYBuNjy1zkXXXGGpXa_!!893191533.jpg","https://img.alicdn.com/tfscom/i2/893191533/TB2PWrtHGmWBuNjy1XaXXXCbXXa_!!893191533.jpg","https://img.alicdn.com/tfscom/i2/893191533/TB2FlIYHrGYBuNjy0FoXXciBFXa_!!893191533.jpg","https://img.alicdn.com/tfscom/i2/893191533/TB2oxHdziCYBuNkSnaVXXcMsVXa_!!893191533.jpg"]},"title":"东大门女装2018秋装新款INS网红连帽卫衣+半身鱼尾裙套装两件套潮","user_type":0,"volume":10,"zk_final_price":"109.00"},{"item_url":"http://item.taobao.com/item.htm?id=576701661968","nick":"mweshop","num_iid":576701661968,"pict_url":"https://img.alicdn.com/tfscom/i4/112632168/TB1MwwJvaAoBKNjSZSyXXaHAVXa_!!0-item_pic.jpg","provcity":"广东 深圳","reserve_price":"59.00","seller_id":112632168,"small_images":{"string":["https://img.alicdn.com/tfscom/i2/112632168/TB2XQkqvBjTBKNjSZFuXXb0HFXa_!!112632168.jpg","https://img.alicdn.com/tfscom/i3/112632168/TB2KNILvrArBKNjSZFLXXc_dVXa_!!112632168.jpg","https://img.alicdn.com/tfscom/i3/112632168/TB2oZ7kvrZnBKNjSZFhXXc.oXXa_!!112632168.jpg","https://img.alicdn.com/tfscom/i4/112632168/TB2n8LKvDqWBKNjSZFAXXanSpXa_!!112632168.jpg"]},"title":"215126 铭薇女装2018秋拉链五分纯色半身裙","user_type":0,"volume":35,"zk_final_price":"29.00"},{"item_url":"http://item.taobao.com/item.htm?id=574778427248","nick":"nancy的传奇","num_iid":574778427248,"pict_url":"https://img.alicdn.com/tfscom/i3/63181773/O1CN011Oy4gBqO3okvKrq_!!63181773.jpg","provcity":"江苏 南京","reserve_price":"229.00","seller_id":63181773,"small_images":{"string":["https://img.alicdn.com/tfscom/i3/63181773/O1CN011Oy4g5zhBUPQpKZ_!!63181773.jpg","https://img.alicdn.com/tfscom/i1/63181773/O1CN011Oy4g6MoQO8v7AG_!!63181773.jpg","https://img.alicdn.com/tfscom/i3/63181773/O1CN011Oy4g5VVT7Op6NQ_!!63181773.jpg","https://img.alicdn.com/tfscom/i1/63181773/O1CN011Oy4gCAcm7rT937_!!63181773.jpg"]},"title":"四月初九加大码女装胖MM2018冬 显气质毛呢格纹无袖外套WU敌推荐","user_type":0,"volume":73,"zk_final_price":"229.00"},{"item_url":"http://item.taobao.com/item.htm?id=575470695401","nick":"qq269516629","num_iid":575470695401,"pict_url":"https://img.alicdn.com/tfscom/https://img.alicdn.com/imgextra/i3/875217645/TB2BxZKnlsmBKNjSZFFXXcT9VXa_!!875217645.jpg","provcity":"广东 广州","reserve_price":"105.00","seller_id":875217645,"small_images":{"string":["https://img.alicdn.com/tfscom/i3/875217645/TB27jadnj7nBKNjSZLeXXbxCFXa_!!875217645.jpg","https://img.alicdn.com/tfscom/i3/875217645/TB2OQ1pnmYTBKNjSZKbXXXJ8pXa_!!875217645.jpg","https://img.alicdn.com/tfscom/i4/875217645/TB23DIVnlsmBKNjSZFsXXaXSVXa_!!875217645.jpg"]},"title":"秋装新款2018大码女装韩版V领衬衫女长袖宽松显瘦碎花雪纺衫","user_type":0,"volume":38,"zk_final_price":"105.00"},{"item_url":"http://item.taobao.com/item.htm?id=577470206181","nick":"feixiang1299","num_iid":577470206181,"pict_url":"https://img.alicdn.com/tfscom/i4/62204604/O1CN011jsfwcw9B1axK0G_!!62204604.jpg","provcity":"江苏 南通","reserve_price":"13.00","seller_id":62204604,"small_images":{"string":["https://img.alicdn.com/tfscom/i3/62204604/O1CN011jsfwea2QGaGBoC_!!62204604.jpg","https://img.alicdn.com/tfscom/i1/62204604/O1CN011jsfwemxbbL5Mba_!!62204604.jpg","https://img.alicdn.com/tfscom/i2/62204604/O1CN011jsfweCkUXNNGEv_!!62204604.jpg","https://img.alicdn.com/tfscom/i2/62204604/O1CN011jsfwdR75u1mTFp_!!62204604.jpg"]},"title":"33163 春秋季新款女装裤子灯芯绒韩版百搭直筒休闲裤九分裤9月15","user_type":0,"volume":55,"zk_final_price":"7.80"},{"item_url":"http://item.taobao.com/item.htm?id=578070964465","nick":"qq543967495","num_iid":578070964465,"pict_url":"https://img.alicdn.com/tfscom/i4/236842879/O1CN011X8cjbDxJp8f9SU_!!236842879.jpg","provcity":"浙江 杭州","reserve_price":"256.00","seller_id":236842879,"small_images":{"string":["https://img.alicdn.com/tfscom/i4/236842879/O1CN011X8cjbDwFKSf0Mr_!!236842879.jpg","https://img.alicdn.com/tfscom/i2/236842879/O1CN011X8cjdFQoT4A8W6_!!236842879.jpg","https://img.alicdn.com/tfscom/i2/236842879/O1CN011X8cjczm5whypPK_!!236842879.jpg","https://img.alicdn.com/tfscom/i1/236842879/O1CN011X8cjeEEIVTjklX_!!236842879.jpg"]},"title":"五季家大码女装2018胖mm秋装新款亮丝洋气落肩长袖宽松针织毛衣女","user_type":0,"volume":95,"zk_final_price":"128.00"},{"item_url":"http://item.taobao.com/item.htm?id=540106238022","nick":"zy2001lian","num_iid":540106238022,"pict_url":"https://img.alicdn.com/tfscom/i3/TB1o1Z0NFXXXXaIXFXXXXXXXXXX_!!0-item_pic.jpg","provcity":"广东 广州","reserve_price":"8.90","seller_id":17137686,"small_images":{"string":["https://img.alicdn.com/tfscom/i1/17137686/TB2eJqYmScqBKNjSZFgXXX_kXXa_!!17137686.jpg","https://img.alicdn.com/tfscom/i3/17137686/TB1zMAoAAOWBuNjSsppXXXPgpXa_!!0-item_pic.jpg","https://img.alicdn.com/tfscom/i2/17137686/TB2zkcWXSxjpuFjSszeXXaeMVXa-17137686.jpg"]},"title":"DSNS女装 秋装棉灯芯绒直筒阔腿休闲长裤子舒适92458两色","user_type":0,"volume":23,"zk_final_price":"8.90"},{"item_url":"http://item.taobao.com/item.htm?id=578086372749","nick":"qq543967495","num_iid":578086372749,"pict_url":"https://img.alicdn.com/tfscom/i2/236842879/O1CN011X8cjdiHPv3Egt0_!!236842879.jpg","provcity":"浙江 杭州","reserve_price":"276.00","seller_id":236842879,"small_images":{"string":["https://img.alicdn.com/tfscom/i3/236842879/O1CN011X8cjd0gq9geKR0_!!236842879.jpg","https://img.alicdn.com/tfscom/i2/236842879/O1CN011X8cjbuJt4aLP9u_!!236842879.jpg","https://img.alicdn.com/tfscom/i2/236842879/O1CN011X8cjWoIdv7aIf8_!!236842879.jpg","https://img.alicdn.com/tfscom/i1/236842879/O1CN011X8cjb7tlMWQGw0_!!236842879.jpg"]},"title":"五季家大码女装2018胖mm秋装新款立领蝴蝶结收腰显瘦时髦连衣裙女","user_type":0,"volume":58,"zk_final_price":"158.00"},{"item_url":"http://item.taobao.com/item.htm?id=576264454020","nick":"coco国际时尚服饰","num_iid":576264454020,"pict_url":"https://img.alicdn.com/tfscom/i3/720853322/O1CN011aPWBd7TgETTbSw_!!720853322.jpg","provcity":"上海","reserve_price":"169.99","seller_id":720853322,"small_images":{"string":["https://img.alicdn.com/tfscom/i3/720853322/O1CN011aPWBdpiTcfE4kK_!!720853322.jpg","https://img.alicdn.com/tfscom/i3/720853322/O1CN011aPWBjupMQWeR0j_!!720853322.jpg","https://img.alicdn.com/tfscom/i2/720853322/O1CN011aPWBacOJm8qDuN_!!720853322.jpg","https://img.alicdn.com/tfscom/i2/720853322/O1CN011aPWBXKoYwpUuoO_!!720853322.jpg"]},"title":"MMCO 2018秋季新款简约V领蝙蝠袖针织衫宽松休闲裤针织套装女装","user_type":0,"volume":2273,"zk_final_price":"129.99"},{"item_url":"http://item.taobao.com/item.htm?id=578319162554","nick":"mweshop","num_iid":578319162554,"pict_url":"https://img.alicdn.com/tfscom/i3/112632168/O1CN011Rsz8FgMiU0Kdqu_!!0-item_pic.jpg","provcity":"广东 深圳","reserve_price":"59.00","seller_id":112632168,"small_images":{"string":["https://img.alicdn.com/tfscom/i1/112632168/TB2CQ9DdwHqK1RjSZFEXXcGMXXa_!!112632168.jpg","https://img.alicdn.com/tfscom/i2/112632168/TB2NKuDdwTqK1RjSZPhXXXfOFXa_!!112632168.jpg","https://img.alicdn.com/tfscom/i1/112632168/TB2kGGDdxTpK1RjSZFKXXa2wXXa_!!112632168.jpg","https://img.alicdn.com/tfscom/i2/112632168/TB22leDdwHqK1RjSZFEXXcGMXXa_!!112632168.jpg"]},"title":"112772 铭薇女装2018秋拉链五分纯色半身裙","user_type":0,"volume":31,"zk_final_price":"29.50"},{"item_url":"http://item.taobao.com/item.htm?id=561026286021","nick":"阿姆嘟嘟","num_iid":561026286021,"pict_url":"https://img.alicdn.com/tfscom/i4/2356472418/TB2pcz0aRfH8KJjy1XbXXbLdXXa_!!2356472418.jpg","provcity":"湖北 武汉","reserve_price":"189.00","seller_id":2356472418,"small_images":{"string":["https://img.alicdn.com/tfscom/i6/TB1V1K8X2jM8KJjSZFyYXFdzVXa_M2.SS2","https://img.alicdn.com/tfscom/i6/TB15Jm4Xjgy_uJjSZPxYXGnNpXa_M2.SS2","https://img.alicdn.com/tfscom/i3/TB1yKe5Xjgy_uJjSZK9YXFvlFXa_M2.SS2","https://img.alicdn.com/tfscom/i1/2356472418/O1CN011TjU8atTF0OepCx_!!2356472418.jpg"]},"title":"现@加肥大码女装胖mm秋装韩版修身小香风复古长袖开衫短款外套折","user_type":0,"volume":73,"zk_final_price":"129.00"},{"item_url":"http://item.taobao.com/item.htm?id=578084956650","nick":"qq543967495","num_iid":578084956650,"pict_url":"https://img.alicdn.com/tfscom/i3/236842879/O1CN011X8cjcOCKsdRv9h_!!236842879.jpg","provcity":"浙江 杭州","reserve_price":"416.00","seller_id":236842879,"small_images":{"string":["https://img.alicdn.com/tfscom/i2/236842879/O1CN011X8cjdVw8md9QXe_!!236842879.jpg","https://img.alicdn.com/tfscom/i2/236842879/O1CN011X8cjeInXBkpVwl_!!236842879.jpg","https://img.alicdn.com/tfscom/i4/236842879/O1CN011X8cjb8S0Cl179L_!!236842879.jpg","https://img.alicdn.com/tfscom/i1/236842879/O1CN011X8cjburvJqgUGm_!!236842879.jpg"]},"title":"五季家大码女装2018胖mm秋装新款针织灯篓袖刺绣印花毛呢连衣裙女","user_type":0,"volume":119,"zk_final_price":"208.00"},{"item_url":"http://item.taobao.com/item.htm?id=576577173422","nick":"毛菇小象","num_iid":576577173422,"pict_url":"https://img.alicdn.com/tfscom/i3/479184430/O1CN011iaz2HCYeGRcnmW_!!0-item_pic.jpg","provcity":"浙江 杭州","reserve_price":"416.00","seller_id":479184430,"small_images":{"string":["https://img.alicdn.com/tfscom/i2/479184430/TB2pHUCciqAXuNjy1XdXXaYcVXa_!!479184430.jpg","https://img.alicdn.com/tfscom/i2/479184430/TB2UAvHeILJ8KJjy0FnXXcFDpXa_!!479184430.jpg","https://img.alicdn.com/tfscom/i3/479184430/TB2mw2xeHYI8KJjy0FaXXbAiVXa_!!479184430.jpg","https://img.alicdn.com/tfscom/i3/479184430/TB20WHAeL6H8KJjSspmXXb2WXXa_!!479184430.jpg"]},"title":"MG小象新款女装2018秋季蝴蝶结套头卫衣复古半身鱼尾裙时尚套装潮","user_type":0,"volume":97,"zk_final_price":"208.00"},{"item_url":"http://item.taobao.com/item.htm?id=578510723766","nick":"qq543967495","num_iid":578510723766,"pict_url":"https://img.alicdn.com/tfscom/i2/236842879/O1CN011X8cjedATEScGVA_!!236842879.jpg","provcity":"浙江 杭州","reserve_price":"356.00","seller_id":236842879,"small_images":{"string":["https://img.alicdn.com/tfscom/i1/236842879/O1CN011X8cjc34KeM8X40_!!236842879.jpg","https://img.alicdn.com/tfscom/i2/236842879/O1CN011X8cjcWP4vSt03G_!!236842879.jpg","https://img.alicdn.com/tfscom/i3/236842879/O1CN011X8cjd1C3IOlt9D_!!236842879.jpg","https://img.alicdn.com/tfscom/i4/236842879/O1CN011X8cjdqrnKr5nTV_!!236842879.jpg"]},"title":"五季家大码女装2018胖mm秋装新款长袖套头毛衣包臀裙针织套装女","user_type":0,"volume":95,"zk_final_price":"178.00"},{"item_url":"http://item.taobao.com/item.htm?id=572407046367","nick":"风疯锋1988","num_iid":572407046367,"pict_url":"https://img.alicdn.com/tfscom/i4/2231111757/TB1NS15AntYBeNjy1XdXXXXyVXa_!!0-item_pic.jpg","provcity":"广东 广州","reserve_price":"23.00","seller_id":2231111757,"small_images":{"string":["https://img.alicdn.com/tfscom/i3/2231111757/TB2P_OBAmtYBeNjSspaXXaOOFXa_!!2231111757.jpg","https://img.alicdn.com/tfscom/i4/2231111757/TB2MaxbjyQnBKNjSZFmXXcApVXa_!!2231111757.jpg","https://img.alicdn.com/tfscom/i3/2231111757/TB2OBX4AhWYBuNjy1zkXXXGGpXa_!!2231111757.jpg","https://img.alicdn.com/tfscom/i3/2231111757/TB2RuomsBmWBuNkSndVXXcsApXa_!!2231111757.jpg"]},"title":"夏装新款女装韩版短袖T恤上衣防走光腿环裤+高腰格子半身裙子套装","user_type":0,"volume":1951,"zk_final_price":"17.98"},{"item_url":"http://item.taobao.com/item.htm?id=576261598148","nick":"coco国际时尚服饰","num_iid":576261598148,"pict_url":"https://img.alicdn.com/tfscom/i4/720853322/O1CN011aPWBd6ZQBggcct_!!720853322.jpg","provcity":"上海","reserve_price":"189.99","seller_id":720853322,"small_images":{"string":["https://img.alicdn.com/tfscom/i4/720853322/O1CN011aPWBccszxqUjg1_!!720853322.jpg","https://img.alicdn.com/tfscom/i3/720853322/O1CN011aPWBiEcckC96p6_!!720853322.jpg","https://img.alicdn.com/tfscom/i2/720853322/O1CN011aPWBahPBef2cAx_!!720853322.jpg","https://img.alicdn.com/tfscom/i2/720853322/O1CN011aPWBQwag44uVWE_!!720853322.jpg"]},"title":"网红毛衣2018秋季新款复古吊带连衣裙简约套头羊毛衫针织套装女装","user_type":0,"volume":5184,"zk_final_price":"109.99"},{"item_url":"http://item.taobao.com/item.htm?id=576829641198","nick":"风疯锋1988","num_iid":576829641198,"pict_url":"https://img.alicdn.com/tfscom/i2/2231111757/TB1WZfwvZj_B1NjSZFHXXaDWpXa_!!0-item_pic.jpg","provcity":"广东 广州","reserve_price":"34.00","seller_id":2231111757,"small_images":{"string":["https://img.alicdn.com/tfscom/i3/2231111757/TB2CSrRv8jTBKNjSZFwXXcG4XXa_!!2231111757.jpg","https://img.alicdn.com/tfscom/i2/2231111757/TB2Ezpnv9MmBKNjSZTEXXasKpXa_!!2231111757.jpg","https://img.alicdn.com/tfscom/i1/2231111757/TB2lasav5MnBKNjSZFzXXc_qVXa_!!2231111757.jpg","https://img.alicdn.com/tfscom/i4/2231111757/O1CN011OqkLQzWklbTyb2_!!2231111757.jpg"]},"title":"秋装新款女装日系甜美百搭针织衫毛衣开衫外套+长袖衬衫上衣套装","user_type":0,"volume":5869,"zk_final_price":"29.98"},{"item_url":"http://item.taobao.com/item.htm?id=578238909301","nick":"qq543967495","num_iid":578238909301,"pict_url":"https://img.alicdn.com/tfscom/i2/236842879/O1CN011X8cjd7Hd4QjeZQ_!!236842879.jpg","provcity":"浙江 杭州","reserve_price":"396.00","seller_id":236842879,"small_images":{"string":["https://img.alicdn.com/tfscom/i4/236842879/O1CN011X8cjbXxy3Qnblt_!!236842879.jpg","https://img.alicdn.com/tfscom/i4/236842879/O1CN011X8cjcmShuBQycS_!!236842879.jpg","https://img.alicdn.com/tfscom/i2/236842879/O1CN011X8cjWRoShBbhYQ_!!236842879.jpg","https://img.alicdn.com/tfscom/i1/236842879/O1CN011X8cjdzQ9RC5QDQ_!!236842879.jpg"]},"title":"五季家大码女装2018胖mm秋装新款洋气圆领拼色系带显瘦针织连衣裙","user_type":0,"volume":48,"zk_final_price":"198.00"},{"item_url":"http://item.taobao.com/item.htm?id=578238857235","nick":"qq543967495","num_iid":578238857235,"pict_url":"https://img.alicdn.com/tfscom/i4/236842879/O1CN011X8cjb7IJ4GGgRX_!!236842879.jpg","provcity":"浙江 杭州","reserve_price":"216.00","seller_id":236842879,"small_images":{"string":["https://img.alicdn.com/tfscom/i3/236842879/O1CN011X8cjdvnfRSLFNn_!!236842879.jpg","https://img.alicdn.com/tfscom/i2/236842879/O1CN011X8cjdvoo3uffCw_!!236842879.jpg","https://img.alicdn.com/tfscom/i3/236842879/O1CN011X8cjcedJM4GGYk_!!236842879.jpg","https://img.alicdn.com/tfscom/i2/236842879/O1CN011X8cjcpNgZEe3S4_!!236842879.jpg"]},"title":"五季家大码女装2018胖mm秋装新款高腰显瘦针织弹力麻花a字半身裙","user_type":0,"volume":130,"zk_final_price":"108.00"}]},"total_results":4983794}}`)
	}
	SetCache = func(cacheKey string, value []byte, expiration time.Duration) bool {
		log.Printf("SetCache key:%s\n|%s|%d\n", cacheKey, string(value), expiration)
		return false
	}
}
func TestExecute(t *testing.T) {
	// http://open.taobao.com/docs/api.htm?apiId=24515
	res, err := Execute("taobao.tbk.item.get", Parameter{
		"fields": "num_iid,title,pict_url,small_images,reserve_price,zk_final_price,user_type,provcity,item_url,seller_id,volume,nick",
		"q":      "女装",
		"cat":    "16,18",
	})

	if err != nil {
		t.Fatal(err)
	}

	fmt.Println("商品数量:", res.Get("tbk_item_get_response").Get("total_results").MustInt())
	var imtes []interface{}
	imtes, _ = res.Get("tbk_item_get_response").Get("results").Get("n_tbk_item").Array()
	for _, v := range imtes {
		fmt.Println("======")
		item := v.(map[string]interface{})
		fmt.Println("商品名称:", item["title"])
		fmt.Println("商品价格:", item["reserve_price"])
		fmt.Println("商品链接:", item["item_url"])
	}
}

func TestExecuteErrMsg(t *testing.T) {
	_, err := Execute("taobao.tbk.dg.material.optional", Parameter{
		"q":   "女装",
		"cat": "16,18",
	})

	if err != nil {
		t.Fatal(err)
	}
}

func TestExecuteCache(t *testing.T) {
	res, err := ExecuteCache("taobao.tbk.item.get", Parameter{
		"fields": "num_iid,title,pict_url,small_images,reserve_price,zk_final_price,user_type,provcity,item_url,seller_id,volume,nick",
		"q":      "女装",
		"cat":    "16,18",
	})
	if err != nil {
		t.Fatal(err)
	}
	t.Logf("%+v\n", res)

}
